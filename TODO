-----------------------------------
Port to clang/clang++ on cygwin
-----------------------------------
Bad news, clang/clang++ doesn't support -I-.
It's time to override by DEFAULT_INCLUDES.

After setting DEFAULT_INCLUDES by -iquote, "make -k" shows:

 $ uname -a
 CYGWIN_NT-5.1 lion 1.7.10(0.259/5/3) 2012-02-05 12:36 i686 Cygwin

 $ clang --version
 clang version 3.0 (tags/RELEASE_30/final)
 Target: i386-pc-cygwin
 Thread model: posix

 $ clang++ --version
 clang version 3.0 (tags/RELEASE_30/final)
 Target: i386-pc-cygwin
 Thread model: posix

 $ CC=clang CXX=clang++ ./configure
 [SNIP]

 $ make -k
 [SNIP]
 make[4]: Entering directory `/home/hiyuh/git-repos/nvc/src/rt'
 clang -DHAVE_CONFIG_H -iquote ../.. -iquote . -iquote . -iquote ../../src -iquote ../../src     -Wall -Werror -g -O2 -MT shell.o -MD -MP -MF .deps/shell.Tpo -c -o shell.o shell.c
 shell.c:226:10: error: implicit declaration of function 'add_history' is invalid in C99
       [-Werror,-Wimplicit-function-declaration]
          add_history(buf);
          ^
 1 error generated.
 Makefile:256: recipe for target `shell.o' failed
 make[4]: *** [shell.o] Error 1
 clang -DHAVE_CONFIG_H -iquote ../.. -iquote . -iquote . -iquote ../../src -iquote ../../src    -Wall -Werror -I/usr/include  -DNDEBUG -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -O3 -fomit-frame-pointer -g -O2 -MT libjit_a-jit.o -MD -MP -MF .deps/libjit_a-jit.Tpo -c -o libjit_a-jit.o `test -f 'jit.c' || echo './'`jit.c
 jit.c:67:14: error: use of undeclared identifier 'PATH_MAX'
    char path[PATH_MAX];
              ^
 1 error generated.
 Makefile:270: recipe for target `libjit_a-jit.o' failed
 make[4]: *** [libjit_a-jit.o] Error 1
 make[4]: Target `all' not remade because of errors.
 make[4]: Leaving directory `/home/hiyuh/git-repos/nvc/src/rt'
 make[4]: Entering directory `/home/hiyuh/git-repos/nvc/src'
 clang -DHAVE_CONFIG_H -iquote .. -iquote . -iquote . -iquote ../src -iquote ../src     -Wall -Werror -g -O2 -MT lib.o -MD -MP -MF .deps/lib.Tpo -c -o lib.o lib.c
 In file included from lib.c:28:
 In file included from /usr/include/dirent.h:6:
 /usr/include/sys/dirent.h:28:15: error: use of undeclared identifier 'NAME_MAX'
   char d_name[NAME_MAX + 1];
               ^
 lib.c:41:25: error: use of undeclared identifier 'PATH_MAX'
    char            path[PATH_MAX];
                         ^
 lib.c:107:13: error: use of undeclared identifier 'PATH_MAX'
    char dir[PATH_MAX];
             ^
 lib.c:117:16: error: use of undeclared identifier 'PATH_MAX'
    char marker[PATH_MAX];
                ^
 lib.c:127:20: error: use of undeclared identifier 'PATH_MAX'
    static char buf[PATH_MAX];
                    ^
 lib.c:256:13: error: use of undeclared identifier 'PATH_MAX'
    char buf[PATH_MAX];
             ^
 lib.c:307:16: error: unused variable 'search' [-Werror,-Wunused-variable]
    const char *search = istr(ident);
                ^
 7 errors generated.
 Makefile:384: recipe for target `lib.o' failed
 [SNIP]

These errors may be cygwin specific and are caused by clang/clang++'s bug, I think.

------------------------------------------------------------------------------------------
Fix "*** glibc detected *** path/to/nvc : double free or corruption (out): 0xXXXXXXXX ***"
------------------------------------------------------------------------------------------
This "double free or corruption" occurs on Gentoo/PowerPC.

Investigating w/ LLVM-3.0 and svn trunk and great helping by NAKAMURA Takumi AKA chapuni,
I finally realized that this problem can be reproduced when using altivec on ppc32-linux.
The point is, LLVM has incomplete support for altivec on ppc32-linux, even w/ svn trunk.
And the workaround is, don't enable altivec when compiling LLVM.

So appending "-mno-altivec -mabi=no-altivec" to CFLAGS and CXXFLAGS can avoid this issue.
Note, -mcpu and -mtune does enable/disable altivec related flags too, so just replacing
only "-maltivec -mabi=altivec" to "-mno-altivec -mabi=no-altivec" may not work as expected
if you used -mcpu and -mtune.

FYI, I filed a bug also for TEXTREL and Anton Korobeynikov AKA asl fixed in r15398:

https://bugs.gentoo.org/show_bug.cgi?id=403519

Anyway, for real fix, I should fix LLVM's lib/Target/PowerPC/PPCJITInfo.cpp or so...

See more detail:

 $ uname -a
 Linux wombat 3.2.5-gentoo #1 Thu Feb 9 14:47:53 JST 2012 ppc 7447A, altivec supported PowerMac10,2 GNU/Linux

 $ eix -Ic sys-devel/llvm
 [I] sys-devel/llvm (3.0-r1@02/17/12): Low Level Virtual Machine
 [NOTE: This sys-devel/llvm-3.0-r1 is compiled w/;
           CFLAGS="-O2 -mtune=G4 -mcpu=G4 -maltivec -mabi=altivec -Wall -ggdb"
         CXXFLAGS="-O2 -mtune=G4 -mcpu=G4 -maltivec -mabi=altivec -Wall -ggdb"
          LDFLAGS="-Wl,-O1 -Wl,--as-needed"]

 $ llvm-config --version
 3.0

 $ git clone git://github.com/hiyuh/nvc.git
 [SNIP]
 $ cd nvc
 $ ./autogen.sh
 [SNIP]
 $ ./configure
 [SNIP]
 [NOTE: Prepare lib/ieee before make. :P]
 $ make
 [SNIP]
 $ make check
 [SNIP]
 make[2]: Entering directory `/home/hiyuh/git-repos/nvc/test'
 Running suite(s): lib
 [gc: freed 0 trees; 35 allocated]
 100%: Checks: 3, Failures: 0, Errors: 0
 PASS: test_lib
 Running suite(s): ident
 100%: Checks: 9, Failures: 0, Errors: 0
 PASS: test_ident
 Running suite(s): parse
 100%: Checks: 19, Failures: 0, Errors: 0
 PASS: test_parse
 Running suite(s): sem
 100%: Checks: 16, Failures: 0, Errors: 0
 PASS: test_sem
 Running suite(s): simplify
 100%: Checks: 2, Failures: 0, Errors: 0
 PASS: test_simp
 Running suite(s): elab
 100%: Checks: 3, Failures: 0, Errors: 0
 PASS: test_elab
 Running suite(s): heap
 100%: Checks: 3, Failures: 0, Errors: 0
 PASS: test_heap
           wait1 : ok
         assert1 : ok
         assign1 : ok
           wait2 : ok
          arith1 : ok
         signal1 : ok
           attr1 : ok
         signal2 : ok
         signal3 : ok
         assign2 : ok
         assign3 : ok
         signal4 : ok
           wait3 : ok
           wait4 : ok
           wait5 : ok
           elab1 : ok
           image : ok
           cond1 : ok
         counter : ok
      last_value : ok
           cond2 : ok
        vecorder : ok
           elab2 : ok
           func1 : ok
         signal5 : ok
          while1 : ok
         signal6 : ok
          slice1 : ok
        logical1 : ok
            lfsr : ok
           link1 : ok
            for1 : ok
       operator1 : ok
            fact : ok
           func2 : ok
          alias1 : ok
          alias2 : ok
           func3 : ok
           func4 : ok
       operator2 : ok
          array1 : ok
            agg1 : ok
            agg2 : ok
           case1 : ok
           func5 : ok
           ieee1 : *** glibc detected *** /home/hiyuh/git-repos/nvc/src/nvc: double free or corruption (out): 0x10d16f78 ***
 ======= Backtrace: =========
 /lib/libc.so.6(+0x81d20)[0xfa5ad20]
 /lib/libc.so.6(cfree+0x8c)[0xfa60054]
 /home/hiyuh/git-repos/nvc/src/nvc[0x104cc09c]
 /home/hiyuh/git-repos/nvc/src/nvc[0x104dcf8c]
 /home/hiyuh/git-repos/nvc/src/nvc(_ZN4llvm13LPPassManager13runOnFunctionERNS_8FunctionE+0x5d8)[0x106c5fd0]
 /home/hiyuh/git-repos/nvc/src/nvc(_ZN4llvm13FPPassManager13runOnFunctionERNS_8FunctionE+0x250)[0x10872168]
 /home/hiyuh/git-repos/nvc/src/nvc(_ZN4llvm23FunctionPassManagerImpl3runERNS_8FunctionE+0x74)[0x108722e4]
 /home/hiyuh/git-repos/nvc/src/nvc(_ZN4llvm19FunctionPassManager3runERNS_8FunctionE+0x88)[0x10872440]
 /home/hiyuh/git-repos/nvc/src/nvc(_ZN4llvm3JIT14jitTheFunctionEPNS_8FunctionERKNS_10MutexGuardE+0x60)[0x1030f780]
 /home/hiyuh/git-repos/nvc/src/nvc(_ZN4llvm3JIT24runJITOnFunctionUnlockedEPNS_8FunctionERKNS_10MutexGuardE+0x58)[0x1030fb04]
 /home/hiyuh/git-repos/nvc/src/nvc(_ZN4llvm3JIT20getPointerToFunctionEPNS_8FunctionE+0x1b4)[0x1030fcf8]
 /home/hiyuh/git-repos/nvc/src/nvc(_ZN4llvm15ExecutionEngine18getPointerToGlobalEPKNS_11GlobalValueE+0x224)[0x10330df4]
 /home/hiyuh/git-repos/nvc/src/nvc(LLVMGetPointerToGlobal+0x24)[0x103368c4]
 /home/hiyuh/git-repos/nvc/src/nvc(jit_fun_ptr+0x54)[0x10140814]
 /home/hiyuh/git-repos/nvc/src/nvc[0x1013d0ac]
 /home/hiyuh/git-repos/nvc/src/nvc(rt_batch_exec+0x60)[0x1013dd20]
 /home/hiyuh/git-repos/nvc/src/nvc(main+0x8e4)[0x1010e384]
 /lib/libc.so.6(+0x23110)[0xf9fc110]
 /lib/libc.so.6(+0x232a0)[0xf9fc2a0]
 ======= Memory map: ========
 00100000-00103000 r-xp 00000000 00:00 0          [vdso]
 0f977000-0f9b5000 r-xp 00000000 08:06 1480582    /lib/libncurses.so.5.9
 0f9b5000-0f9c5000 ---p 0003e000 08:06 1480582    /lib/libncurses.so.5.9
 0f9c5000-0f9c8000 r--p 0003e000 08:06 1480582    /lib/libncurses.so.5.9
 0f9c8000-0f9c9000 rw-p 00041000 08:06 1480582    /lib/libncurses.so.5.9
 0f9d9000-0fb3d000 r-xp 00000000 08:06 1740830    /lib/libc-2.14.1.so
 0fb3d000-0fb4d000 ---p 00164000 08:06 1740830    /lib/libc-2.14.1.so
 0fb4d000-0fb51000 r--p 00164000 08:06 1740830    /lib/libc-2.14.1.so
 0fb51000-0fb52000 rw-p 00168000 08:06 1740830    /lib/libc-2.14.1.so
 0fb52000-0fb55000 rw-p 00000000 00:00 0
 0fb65000-0fb7a000 r-xp 00000000 08:06 267158     /lib/libgcc_s.so.1
 0fb7a000-0fb8a000 ---p 00015000 08:06 267158     /lib/libgcc_s.so.1
 0fb8a000-0fb8b000 r--p 00015000 08:06 267158     /lib/libgcc_s.so.1
 0fb8b000-0fb8c000 rw-p 00016000 08:06 267158     /lib/libgcc_s.so.1
 0fb9c000-0fc41000 r-xp 00000000 08:06 1740232    /lib/libm-2.14.1.so
 0fc41000-0fc51000 ---p 000a5000 08:06 1740232    /lib/libm-2.14.1.so
 0fc51000-0fc54000 r--p 000a5000 08:06 1740232    /lib/libm-2.14.1.so
 0fc54000-0fc55000 rw-p 000a8000 08:06 1740232    /lib/libm-2.14.1.so
 0fc65000-0fd6c000 r-xp 00000000 08:06 2375450    /usr/lib/gcc/powerpc-unknown-linux-gnu/4.5.3/libstdc++.so.6.0.14
 0fd6c000-0fd7b000 ---p 00107000 08:06 2375450    /usr/lib/gcc/powerpc-unknown-linux-gnu/4.5.3/libstdc++.so.6.0.14
 0fd7b000-0fd80000 r--p 00106000 08:06 2375450    /usr/lib/gcc/powerpc-unknown-linux-gnu/4.5.3/libstdc++.so.6.0.14
 0fd80000-0fd82000 rw-p 0010b000 08:06 2375450    /usr/lib/gcc/powerpc-unknown-linux-gnu/4.5.3/libstdc++.so.6.0.14
 0fd82000-0fd88000 rw-p 00000000 00:00 0
 0fd98000-0fdcc000 r-xp 00000000 08:06 1203034    /lib/libreadline.so.6.2
 0fdcc000-0fddb000 ---p 00034000 08:06 1203034    /lib/libreadline.so.6.2
 0fddb000-0fddd000 r--p 00033000 08:06 1203034    /lib/libreadline.so.6.2
 0fddd000-0fde0000 rw-p 00035000 08:06 1203034    /lib/libreadline.so.6.2
 0fde0000-0fde2000 rw-p 00000000 00:00 0
 0fdf2000-0fee6000 r-xp 00000000 08:06 1593415    /usr/lib/libtcl8.5.so
 0fee6000-0fef5000 ---p 000f4000 08:06 1593415    /usr/lib/libtcl8.5.so
 0fef5000-0fefa000 r--p 000f3000 08:06 1593415    /usr/lib/libtcl8.5.so
 0fefa000-0fefe000 rw-p 000f8000 08:06 1593415    /usr/lib/libtcl8.5.so
 0fefe000-0feff000 rw-p 00000000 00:00 0
 0ff0f000-0ff55000 r-xp 00000000 08:06 1480465    /lib/libncursesw.so.5.9
 0ff55000-0ff64000 ---p 00046000 08:06 1480465    /lib/libncursesw.so.5.9
 0ff64000-0ff67000 r--p 00045000 08:06 1480465    /lib/libncursesw.so.5.9
 0ff67000-0ff68000 rw-p 00048000 08:06 1480465    /lib/libncursesw.so.5.9
 0ff78000-0ff7b000 r-xp 00000000 08:06 1740289    /lib/libdl-2.14.1.so
 0ff7b000-0ff8a000 ---p 00003000 08:06 1740289    /lib/libdl-2.14.1.so
 0ff8a000-0ff8b000 r--p 00002000 08:06 1740289    /lib/libdl-2.14.1.so
 0ff8b000-0ff8c000 rw-p 00003000 08:06 1740289    /lib/libdl-2.14.1.so
 0ff9c000-0ffa3000 r-xp 00000000 08:06 1204137    /usr/lib/libffi.so.5.0.10
 0ffa3000-0ffb3000 ---p 00007000 08:06 1204137    /usr/lib/libffi.so.5.0.10
 0ffb3000-0ffb4000 r--p 00007000 08:06 1204137    /usr/lib/libffi.so.5.0.10
 0ffb4000-0ffb5000 rw-p 00008000 08:06 1204137    /usr/lib/libffi.so.5.0.10
 0ffc5000-0ffdc000 r-xp 00000000 08:06 1740593    /lib/libpthread-2.14.1.so
 0ffdc000-0ffec000 ---p 00017000 08:06 1740593    /lib/libpthread-2.14.1.so
 0ffec000-0ffed000 r--p 00017000 08:06 1740593    /lib/libpthread-2.14.1.so
 0ffed000-0ffee000 rw-p 00018000 08:06 1740593    /lib/libpthread-2.14.1.so
 0ffee000-0fff0000 rw-p 00000000 00:00 0
 10000000-10956000 r-xp 00000000 08:06 841761     /home/hiyuh/git-repos/nvc/src/nvc
 10966000-1097d000 r--p 00956000 08:06 841761     /home/hiyuh/git-repos/nvc/src/nvc
 1097d000-10988000 rw-p 0096d000 08:06 841761     /home/hiyuh/git-repos/nvc/src/nvc
 10988000-1098f000 rwxp 00000000 00:00 0
 10c7c000-10d63000 rwxp 00000000 00:00 0          [heap]
 48000000-48020000 r-xp 00000000 08:06 1740829    /lib/ld-2.14.1.so
 48020000-48021000 rw-p 00000000 00:00 0
 48021000-48022000 r--p 00021000 08:06 1740829    /lib/ld-2.14.1.so
 48022000-48023000 rw-p 00022000 08:06 1740829    /lib/ld-2.14.1.so
 48023000-48025000 rw-p 00000000 00:00 0
 4802d000-48031000 rw-p 00000000 00:00 0
 48031000-480d1000 rwxp 00000000 00:00 0
 bfdab000-bfdcc000 rw-p 00000000 00:00 0          [stack]
 failed
 /home/hiyuh/git-repos/nvc/src/nvc -a /home/hiyuh/git-repos/nvc/test/regress/ieee1.vhd
 [gc: freed 682 trees; 675 allocated]
 /home/hiyuh/git-repos/nvc/src/nvc -e ieee1
 [gc: freed 0 trees; 726 allocated]
 IEEE.STD_LOGIC_1164
 /usr/bin/llvm-ld -r -b /home/hiyuh/git-repos/nvc/test/logs/ieee1/work/_WORK.IEEE1.final.bc /home/hiyuh/git-repos/nvc/test/logs/ieee1/work/_WORK.IEEE1.elab.bc /home/hiyuh/git-repos/nvc/lib/ieee/ieee/_IEEE.STD_LOGIC_1164-body.bc
 /home/hiyuh/git-repos/nvc/src/nvc -r  ieee1
 Stack dump:
 0.      Running pass 'Loop Pass Manager' on function '@"IEEE.STD_LOGIC_1164.\22or\22$IEEE.STD_LOGIC_1164.STD_LOGIC_VECTOR$IEEE.STD_LOGIC_1164.STD_LOGIC_VECTOR"'
 1.      Running pass 'Loop Strength Reduction' on basic block '%while'

           ieee2 : ok
           cond3 : ok
         concat1 : ok
         concat2 : ok
           null1 : ok
 FAIL: run_regr.rb
 ==============================================
 1 of 8 tests failed
 Please report to Nick Gasson <nick@nick.me.uk>
 ==============================================
 make[2]: *** [check-TESTS] Error 1
 make[2]: Leaving directory `/home/hiyuh/git-repos/nvc/test'
 [SNIP]

On the above log, "double free or corruption" occurs w/ ieee1 regression only.
But this symptoms looks not deterministic.
IIRC, I've got same error w/ other regression and also ieee1 regression finishes successfully sometimes.
And it looks the problem is in LLVM internal.

Try ieee1 regression again, and w/ valgrind:

 $ cd test
 $ ./run_regr.sh each ieee1
 > analyze
 >> analyze regress/ieee1.vhd
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -a regress/ieee1.vhd
 [gc: freed 682 trees; 675 allocated]
 > elaborate
 >> elaborate ieee1
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -e ieee1
 [gc: freed 0 trees; 726 allocated]
 IEEE.STD_LOGIC_1164
 /usr/bin/llvm-ld -r -b /home/hiyuh/git-repos/nvc/test/work/_WORK.IEEE1.final.bc /home/hiyuh/git-repos/nvc/test/work/_WORK.IEEE1.elab.bc /home/hiyuh/git-repos/nvc/lib/ieee/ieee/_IEEE.STD_LOGIC_1164-body.bc
 > run
 >> run ieee1
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -r ieee1
 *** glibc detected *** ../src/nvc: double free or corruption (!prev): 0x1106d8b0 ***
 ======= Backtrace: =========
 /lib/libc.so.6(+0x81d20)[0xfa5ad20]
 /lib/libc.so.6(cfree+0x8c)[0xfa60054]
 /usr/lib/gcc/powerpc-unknown-linux-gnu/4.5.3/libstdc++.so.6(_ZdlPv+0x2c)[0xfd2fc98]
 ../src/nvc[0x104cc210]
 ../src/nvc[0x104dcf8c]
 ../src/nvc(_ZN4llvm13LPPassManager13runOnFunctionERNS_8FunctionE+0x5d8)[0x106c5fd0]
 ../src/nvc(_ZN4llvm13FPPassManager13runOnFunctionERNS_8FunctionE+0x250)[0x10872168]
 ../src/nvc(_ZN4llvm23FunctionPassManagerImpl3runERNS_8FunctionE+0x74)[0x108722e4]
 ../src/nvc(_ZN4llvm19FunctionPassManager3runERNS_8FunctionE+0x88)[0x10872440]
 ../src/nvc(_ZN4llvm3JIT14jitTheFunctionEPNS_8FunctionERKNS_10MutexGuardE+0x60)[0x1030f780]
 ../src/nvc(_ZN4llvm3JIT24runJITOnFunctionUnlockedEPNS_8FunctionERKNS_10MutexGuardE+0x58)[0x1030fb04]
 ../src/nvc(_ZN4llvm3JIT20getPointerToFunctionEPNS_8FunctionE+0x1b4)[0x1030fcf8]
 ../src/nvc(_ZN4llvm15ExecutionEngine18getPointerToGlobalEPKNS_11GlobalValueE+0x224)[0x10330df4]
 ../src/nvc(LLVMGetPointerToGlobal+0x24)[0x103368c4]
 ../src/nvc(jit_fun_ptr+0x54)[0x10140814]
 ../src/nvc[0x1013d0ac]
 ../src/nvc(rt_batch_exec+0x60)[0x1013dd20]
 ../src/nvc(main+0x8e4)[0x1010e384]
 /lib/libc.so.6(+0x23110)[0xf9fc110]
 /lib/libc.so.6(+0x232a0)[0xf9fc2a0]
 ======= Memory map: ========
 00100000-00103000 r-xp 00000000 00:00 0          [vdso]
 0f977000-0f9b5000 r-xp 00000000 08:06 1480582    /lib/libncurses.so.5.9
 0f9b5000-0f9c5000 ---p 0003e000 08:06 1480582    /lib/libncurses.so.5.9
 0f9c5000-0f9c8000 r--p 0003e000 08:06 1480582    /lib/libncurses.so.5.9
 0f9c8000-0f9c9000 rw-p 00041000 08:06 1480582    /lib/libncurses.so.5.9
 0f9d9000-0fb3d000 r-xp 00000000 08:06 1740830    /lib/libc-2.14.1.so
 0fb3d000-0fb4d000 ---p 00164000 08:06 1740830    /lib/libc-2.14.1.so
 0fb4d000-0fb51000 r--p 00164000 08:06 1740830    /lib/libc-2.14.1.so
 0fb51000-0fb52000 rw-p 00168000 08:06 1740830    /lib/libc-2.14.1.so
 0fb52000-0fb55000 rw-p 00000000 00:00 0
 0fb65000-0fb7a000 r-xp 00000000 08:06 267158     /lib/libgcc_s.so.1
 0fb7a000-0fb8a000 ---p 00015000 08:06 267158     /lib/libgcc_s.so.1
 0fb8a000-0fb8b000 r--p 00015000 08:06 267158     /lib/libgcc_s.so.1
 0fb8b000-0fb8c000 rw-p 00016000 08:06 267158     /lib/libgcc_s.so.1
 0fb9c000-0fc41000 r-xp 00000000 08:06 1740232    /lib/libm-2.14.1.so
 0fc41000-0fc51000 ---p 000a5000 08:06 1740232    /lib/libm-2.14.1.so
 0fc51000-0fc54000 r--p 000a5000 08:06 1740232    /lib/libm-2.14.1.so
 0fc54000-0fc55000 rw-p 000a8000 08:06 1740232    /lib/libm-2.14.1.so
 0fc65000-0fd6c000 r-xp 00000000 08:06 2375450    /usr/lib/gcc/powerpc-unknown-linux-gnu/4.5.3/libstdc++.so.6.0.14
 0fd6c000-0fd7b000 ---p 00107000 08:06 2375450    /usr/lib/gcc/powerpc-unknown-linux-gnu/4.5.3/libstdc++.so.6.0.14
 0fd7b000-0fd80000 r--p 00106000 08:06 2375450    /usr/lib/gcc/powerpc-unknown-linux-gnu/4.5.3/libstdc++.so.6.0.14
 0fd80000-0fd82000 rw-p 0010b000 08:06 2375450    /usr/lib/gcc/powerpc-unknown-linux-gnu/4.5.3/libstdc++.so.6.0.14
 0fd82000-0fd88000 rw-p 00000000 00:00 0
 0fd98000-0fdcc000 r-xp 00000000 08:06 1203034    /lib/libreadline.so.6.2
 0fdcc000-0fddb000 ---p 00034000 08:06 1203034    /lib/libreadline.so.6.2
 0fddb000-0fddd000 r--p 00033000 08:06 1203034    /lib/libreadline.so.6.2
 0fddd000-0fde0000 rw-p 00035000 08:06 1203034    /lib/libreadline.so.6.2
 0fde0000-0fde2000 rw-p 00000000 00:00 0
 0fdf2000-0fee6000 r-xp 00000000 08:06 1593415    /usr/lib/libtcl8.5.so
 0fee6000-0fef5000 ---p 000f4000 08:06 1593415    /usr/lib/libtcl8.5.so
 0fef5000-0fefa000 r--p 000f3000 08:06 1593415    /usr/lib/libtcl8.5.so
 0fefa000-0fefe000 rw-p 000f8000 08:06 1593415    /usr/lib/libtcl8.5.so
 0fefe000-0feff000 rw-p 00000000 00:00 0
 0ff0f000-0ff55000 r-xp 00000000 08:06 1480465    /lib/libncursesw.so.5.9
 0ff55000-0ff64000 ---p 00046000 08:06 1480465    /lib/libncursesw.so.5.9
 0ff64000-0ff67000 r--p 00045000 08:06 1480465    /lib/libncursesw.so.5.9
 0ff67000-0ff68000 rw-p 00048000 08:06 1480465    /lib/libncursesw.so.5.9
 0ff78000-0ff7b000 r-xp 00000000 08:06 1740289    /lib/libdl-2.14.1.so
 0ff7b000-0ff8a000 ---p 00003000 08:06 1740289    /lib/libdl-2.14.1.so
 0ff8a000-0ff8b000 r--p 00002000 08:06 1740289    /lib/libdl-2.14.1.so
 0ff8b000-0ff8c000 rw-p 00003000 08:06 1740289    /lib/libdl-2.14.1.so
 0ff9c000-0ffa3000 r-xp 00000000 08:06 1204137    /usr/lib/libffi.so.5.0.10
 0ffa3000-0ffb3000 ---p 00007000 08:06 1204137    /usr/lib/libffi.so.5.0.10
 0ffb3000-0ffb4000 r--p 00007000 08:06 1204137    /usr/lib/libffi.so.5.0.10
 0ffb4000-0ffb5000 rw-p 00008000 08:06 1204137    /usr/lib/libffi.so.5.0.10
 0ffc5000-0ffdc000 r-xp 00000000 08:06 1740593    /lib/libpthread-2.14.1.so
 0ffdc000-0ffec000 ---p 00017000 08:06 1740593    /lib/libpthread-2.14.1.so
 0ffec000-0ffed000 r--p 00017000 08:06 1740593    /lib/libpthread-2.14.1.so
 0ffed000-0ffee000 rw-p 00018000 08:06 1740593    /lib/libpthread-2.14.1.so
 0ffee000-0fff0000 rw-p 00000000 00:00 0
 10000000-10956000 r-xp 00000000 08:06 841761     /home/hiyuh/git-repos/nvc/src/nvc
 10966000-1097d000 r--p 00956000 08:06 841761     /home/hiyuh/git-repos/nvc/src/nvc
 1097d000-10988000 rw-p 0096d000 08:06 841761     /home/hiyuh/git-repos/nvc/src/nvc
 10988000-1098f000 rwxp 00000000 00:00 0
 10fa7000-1108e000 rwxp 00000000 00:00 0          [heap]
 48000000-48020000 r-xp 00000000 08:06 1740829    /lib/ld-2.14.1.so
 48020000-48021000 rw-p 00000000 00:00 0
 48021000-48022000 r--p 00021000 08:06 1740829    /lib/ld-2.14.1.so
 48022000-48023000 rw-p 00022000 08:06 1740829    /lib/ld-2.14.1.so
 48023000-48025000 rw-p 00000000 00:00 0
 4802d000-48031000 rw-p 00000000 00:00 0
 48031000-480d1000 rwxp 00000000 00:00 0
 bf88a000-bf8ab000 rw-p 00000000 00:00 0          [stack]
 Stack dump:
 0.      Running pass 'Loop Pass Manager' on function '@"IEEE.STD_LOGIC_1164.\22or\22$IEEE.STD_LOGIC_1164.STD_LOGIC_VECTOR$IEEE.STD_LOGIC_1164.STD_LOGIC_VECTOR"'
 1.      Running pass 'Loop Strength Reduction' on basic block '%while'
 ./run_regr.sh: line 43: 15499 Aborted                 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -r ieee1

 $ NVC_LIBPATH=../lib/std:../lib/ieee valgrind --leak-check=full ../src/nvc -r ieee1
 ==15534== Memcheck, a memory error detector
 ==15534== Copyright (C) 2002-2011, and GNU GPL'd, by Julian Seward et al.
 ==15534== Using Valgrind-3.7.0 and LibVEX; rerun with -h for copyright info
 ==15534== Command: ../src/nvc -r ieee1
 ==15534==
 ==15534==
 ==15534== HEAP SUMMARY:
 ==15534==     in use at exit: 191,901 bytes in 2,664 blocks
 ==15534==   total heap usage: 13,884 allocs, 11,220 frees, 1,927,036 bytes allocated
 ==15534==
 ==15534== 8,640 bytes in 15 blocks are possibly lost in loss record 447 of 449
 ==15534==    at 0xFFB6EB4: operator new(unsigned int) (vg_replace_malloc.c:282)
 ==15534==    by 0x1087F69F: llvm::User::operator new(unsigned int, unsigned int) (in /home/hiyuh/git-repos/nvc/src/nvc)
 ==15534==    by 0x107F3C7B: llvm::ConstantUniqueMap<std::vector<llvm::Constant*, std::allocator<llvm::Constant*> >, llvm::ArrayRef<llvm::Constant*>, llvm::ArrayType, llvm::ConstantArray, true>::Create(llvm::ArrayType*, llvm::ArrayRef<llvm::Constant*>, std::_Rb_tree_iterator<std::pair<std::pair<llvm::ArrayType*, std::vector<llvm::Constant*, std::allocator<llvm::Constant*> > > const, llvm::ConstantArray*> >) (in /home/hiyuh/git-repos/nvc/src/nvc)
 ==15534==    by 0x107F40C3: llvm::ConstantUniqueMap<std::vector<llvm::Constant*, std::allocator<llvm::Constant*> >, llvm::ArrayRef<llvm::Constant*>, llvm::ArrayType, llvm::ConstantArray, true>::getOrCreate(llvm::ArrayType*, llvm::ArrayRef<llvm::Constant*>) (in /home/hiyuh/git-repos/nvc/src/nvc)
 ==15534==    by 0x107E8C43: llvm::ConstantArray::get(llvm::ArrayType*, llvm::ArrayRef<llvm::Constant*>) (in /home/hiyuh/git-repos/nvc/src/nvc)
 ==15534==    by 0x101604BF: llvm::BitcodeReader::ParseConstants() (in /home/hiyuh/git-repos/nvc/src/nvc)
 ==15534==    by 0x1016265F: llvm::BitcodeReader::ParseModule() (in /home/hiyuh/git-repos/nvc/src/nvc)
 ==15534==    by 0x101635BF: llvm::BitcodeReader::ParseBitcodeInto(llvm::Module*) (in /home/hiyuh/git-repos/nvc/src/nvc)
 ==15534==    by 0x1016385B: llvm::getLazyBitcodeModule(llvm::MemoryBuffer*, llvm::LLVMContext&, std::string*) (in /home/hiyuh/git-repos/nvc/src/nvc)
 ==15534==    by 0x1016390B: llvm::ParseBitcodeFile(llvm::MemoryBuffer*, llvm::LLVMContext&, std::string*) (in /home/hiyuh/git-repos/nvc/src/nvc)
 ==15534==    by 0x10158B0F: LLVMParseBitcodeInContext (in /home/hiyuh/git-repos/nvc/src/nvc)
 ==15534==    by 0x10158C07: LLVMParseBitcode (in /home/hiyuh/git-repos/nvc/src/nvc)
 ==15534==
 ==15534== LEAK SUMMARY:
 ==15534==    definitely lost: 0 bytes in 0 blocks
 ==15534==    indirectly lost: 0 bytes in 0 blocks
 ==15534==      possibly lost: 8,640 bytes in 15 blocks
 ==15534==    still reachable: 183,261 bytes in 2,649 blocks
 ==15534==         suppressed: 0 bytes in 0 blocks
 ==15534== Reachable blocks (those to which a pointer was found) are not shown.
 ==15534== To see them, rerun with: --leak-check=full --show-reachable=yes
 ==15534==
 ==15534== For counts of detected and suppressed errors, rerun with: -v
 ==15534== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 7 from 5)

------------------------
Support make -j* in lib/
------------------------
SSIA, at least lib/ieee/Makefile.am works properly only when make -j1.

-----------------------
Fix SIGSEGV on _image()
-----------------------
Even if I W/A LLVM altivec bug, NVC vomits SIGSEGV on _image() on ppc32-linux.

See more detail:

 $ uname -a
 Linux wombat 3.3.0-gentoo #1 Wed Mar 21 11:48:23 JST 2012 ppc 7447A, altivec supported PowerMac10,2 GNU/Linux

 $ eix -Ic sys-devel/llvm
 [I] sys-devel/llvm (9999@04/04/12): Low Level Virtual Machine
 [NOTE: This sys-devel/llvm-9999 is compiled w/;
           CFLAGS="-O2 -mtune=G4 -mcpu=G4 -maltivec -mabi=altivec -Wall -fno-strict-aliasing -mno-altivec -mabi=no-altivec -ggdb"
         CXXFLAGS="-O2 -mtune=G4 -mcpu=G4 -maltivec -mabi=altivec -Wall -fno-strict-aliasing -mno-altivec -mabi=no-altivec -ggdb"
          LDFLAGS="-Wl,-O1 -Wl,--as-needed"
        to workaround LLVM's altivec bug.]

 $ llvm-config --version
 3.1svn
 [NOTE: This sys-devel/llvm-999 is live svn ebuild.
        ATM, used svn trunk tells me it is r153997.]

 $ git clone git://github.com/hiyuh/nvc.git
 [SNIP]
 $ cd nvc
 $ ./autogen.sh
 [SNIP]
 $ CFLAGS="-O0 -ggdb" CXXFLAGS="-O0 -ggdb" ./configure
 [SNIP]
 [NOTE: Prepare lib/ieee before make. :P]
 $ make
 [SNIP]
 $ make check
 [SNIP]
           image : failed
 /home/hiyuh/git-repos/nvc/src/nvc -a /home/hiyuh/git-repos/nvc/test/regress/image.vhd
 /home/hiyuh/git-repos/nvc/src/nvc -e image
 /usr/bin/llvm-ld -r -b /home/hiyuh/git-repos/nvc/test/logs/image/work/_WORK.IMAGE.final.bc /home/hiyuh/git-repos/nvc/test/logs/image/work/_WORK.IMAGE.elab.bc /home/hiyuh/git-repos/nvc/test/logs/image/work/_WORK.P-body.bc
 /home/hiyuh/git-repos/nvc/src/nvc -r  image

 *** Caught signal 11 (SIGSEGV) [address=(nil), ip=0xed9a110] ***

 -------- STACK TRACE --------
 /lib/libc.so.6(strlen+0xc) [0xed9a110]
 [0x2cd]
 /home/hiyuh/git-repos/nvc/src/nvc() [0x100073a0]
 /home/hiyuh/git-repos/nvc/src/nvc(lib_find+0x30) [0x10007b10]
 /home/hiyuh/git-repos/nvc/src/nvc() [0x100516f8]
 /home/hiyuh/git-repos/nvc/src/nvc() [0x100518c0]
 /home/hiyuh/git-repos/nvc/src/nvc(_image+0x74) [0x1004f574]
 [0x480320b0]
 /home/hiyuh/git-repos/nvc/src/nvc() [0x10050770]
 /home/hiyuh/git-repos/nvc/src/nvc() [0x10051348]
 /home/hiyuh/git-repos/nvc/src/nvc(rt_batch_exec+0x60) [0x10051fe0]
 /home/hiyuh/git-repos/nvc/src/nvc() [0x10006df4]
 /home/hiyuh/git-repos/nvc/src/nvc(main+0x1c0) [0x10007314]
 /lib/libc.so.6(+0x23110) [0xed32110]
 /lib/libc.so.6(+0x232a0) [0xed322a0]
 -----------------------------
 [SNIP]

 $ cd test
 $ ./run_regr.sh all image
 > analyze
 >> analyze regress/image.vhd
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -a regress/image.vhd
 > elaborate
 >> elaborate image
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -e image
 /usr/bin/llvm-ld -r -b /home/hiyuh/git-repos/nvc/test/work/_WORK.IMAGE.final.bc /home/hiyuh/git-repos/nvc/test/work/_WORK.IMAGE.elab.bc /home/hiyuh/git-repos/nvc/test/work/_WORK.P-body.bc
 > run
 >> run image
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -r image

 *** Caught signal 11 (SIGSEGV) [address=(nil), ip=0xed9a110] ***

 -------- STACK TRACE --------
 /lib/libc.so.6(strlen+0xc) [0xed9a110]
 [0x2cd]
 ../src/nvc() [0x100073a0]
 ../src/nvc(lib_find+0x30) [0x10007b10]
 ../src/nvc() [0x100516f8]
 ../src/nvc() [0x100518c0]
 ../src/nvc(_image+0x74) [0x1004f574]
 [0x480320b0]
 ../src/nvc() [0x10050770]
 ../src/nvc() [0x10051348]
 ../src/nvc(rt_batch_exec+0x60) [0x10051fe0]
 ../src/nvc() [0x10006df4]
 ../src/nvc(main+0x1c0) [0x10007314]
 /lib/libc.so.6(+0x23110) [0xed32110]
 /lib/libc.so.6(+0x232a0) [0xed322a0]
 -----------------------------

Try reduced regression again,

 $ ./run_regr.sh all reduced_image
 > analyze
 >> analyze regress/reduced_image.vhd
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -a regress/reduced_image.vhd
 > elaborate
 >> elaborate reduced_image
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -e reduced_image
 /usr/bin/llvm-ld -r -b /home/hiyuh/git-repos/nvc/test/work/_WORK.REDUCED_IMAGE.final.bc /home/hiyuh/git-repos/nvc/test/work/_WORK.REDUCED_IMAGE.elab.bc
 > run
 >> run reduced_image
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -r reduced_image

 *** Caught signal 11 (SIGSEGV) [address=(nil), ip=0xed9a110] ***

 -------- STACK TRACE --------
 /lib/libc.so.6(strlen+0xc) [0xed9a110]
 [0x2cd]
 ../src/nvc() [0x100073a0]
 ../src/nvc(lib_find+0x30) [0x10007b10]
 ../src/nvc() [0x100516f8]
 ../src/nvc() [0x100518c0]
 ../src/nvc(_image+0x74) [0x1004f574]
 [0x4803206c]
 ../src/nvc() [0x10050770]
 ../src/nvc() [0x10051348]
 ../src/nvc(rt_batch_exec+0x60) [0x10051fe0]
 ../src/nvc() [0x10006df4]
 ../src/nvc(main+0x1c0) [0x10007314]
 /lib/libc.so.6(+0x23110) [0xed32110]
 /lib/libc.so.6(+0x232a0) [0xed322a0]
 -----------------------------

 $ EXTRA_RFLAGS="--trace" ./run_regr.sh run reduced_image
 > run
 >> run reduced_image
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -r --trace reduced_image
 TRACE (init): process :reduced_image(test):_proc at 0x48032010
 TRACE (init): reset process :reduced_image(test):_proc
 TRACE (init): _sched_process delay=0ms
 TRACE 0ms+0: begin cycle
 0ms     process  :reduced_image(test):_proc
 TRACE 0ms+0: run process :reduced_image(test):_proc
 TRACE 0ms+0: _image val=c8480b2010 where=1208754184 module="(null)"

 *** Caught signal 11 (SIGSEGV) [address=(nil), ip=0xed9a110] ***

 -------- STACK TRACE --------
 /lib/libc.so.6(strlen+0xc) [0xed9a110]
 /lib/libc.so.6(__overflow+0x74) [0xed8defc]
 ../src/nvc() [0x100516c8]
 ../src/nvc() [0x100518c0]
 ../src/nvc(_image+0x74) [0x1004f574]
 [0x4803206c]
 ../src/nvc() [0x10050770]
 ../src/nvc() [0x10051348]
 ../src/nvc(rt_batch_exec+0x60) [0x10051fe0]
 ../src/nvc() [0x10006df4]
 ../src/nvc(main+0x1c0) [0x10007314]
 /lib/libc.so.6(+0x23110) [0xed32110]
 /lib/libc.so.6(+0x232a0) [0xed322a0]
 -----------------------------

I don't know why modele is null, and nickg also has no idea.

https://github.com/hiyuh/nvc/commit/931c8731d53ac925aa3c5a3703d622db6166cc34#commitcomment-1126798

Also, on i686-cygwin, it works fine.

 $ uname -a
 CYGWIN_NT-5.1 lion 1.7.11(0.260/5/3) 2012-02-24 14:05 i686 Cygwin

 $ EXTRA_RFLAGS="--trace" ./run_regr.sh run reduced_image
 > run
 >> run reduced_image
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -r --trace reduced_image
 TRACE (init): process :reduced_image(test):_proc at 0x7ff30010
 TRACE (init): reset process :reduced_image(test):_proc
 TRACE (init): _sched_process delay=0ms
 TRACE 0ms+0: begin cycle
 0ms     process  :reduced_image(test):_proc
 TRACE 0ms+0: run process :reduced_image(test):_proc
 TRACE 0ms+0: _image val=4 where=200 module="WORK.REDUCED_IMAGE.elab"
 TRACE 0ms+0: _assert_fail msg=4 msg_len=1 severity=0 where=2 module=WORK.REDUCED_IMAGE.elab
 ** Note: 0ms+0: Report Note: 4
         File regress/reduced_image.vhd, Line 9

So I'd have to say this is a LLVM bug itself.
To investigate more detail, do llvm-dis reduced regression's bitcode,

 $ llvm-dis work/_WORK.REDUCED_IMAGE.final.bc

Now we get following LLVM IR named work/_WORK.REDUCED_IMAGE.final.ll,

  1 ; ModuleID = 'work/_WORK.REDUCED_IMAGE.final.bc'
  2
  3 @module_name = private global [24 x i8] c"WORK.REDUCED_IMAGE.elab\00"
  4 @":reduced_image(test):_proc__state.0" = internal unnamed_addr global i32 undef, align 8
  5
  6 declare void @_sched_process(i64)
  7
  8 declare void @_assert_fail(i8*, i32, i8, i32, i8*)
  9
 10 declare { i8*, i32, i32, i8 } @_image(i64, i32, i8*)
 11
 12 define void @":reduced_image(test):_proc"(i32) {
 13 entry:
 14   %1 = icmp eq i32 %0, 0
 15   %2 = load i32* @":reduced_image(test):_proc__state.0", align 8
 16   %switch = icmp ult i32 %2, 2
 17   %or.cond = and i1 %1, %switch
 18   br i1 %or.cond, label %start, label %init
 19
 20 init:                                             ; preds = %entry
 21   call void @_sched_process(i64 0)
 22   store i32 0, i32* @":reduced_image(test):_proc__state.0", align 8
 23   ret void
 24
 25 start:                                            ; preds = %entry
 26   %3 = call { i8*, i32, i32, i8 } @_image(i64 4, i32 200, i8* getelementptr inbounds ([24 x i8]* @module_name, i64 0, i64 0))
 27   %aptr = extractvalue { i8*, i32, i32, i8 } %3, 0
 28   %dir = extractvalue { i8*, i32, i32, i8 } %3, 3
 29   %downto = icmp eq i8 %dir, 1
 30   %left = extractvalue { i8*, i32, i32, i8 } %3, 1
 31   %right = extractvalue { i8*, i32, i32, i8 } %3, 2
 32   %4 = sub i32 %left, %right
 33   %5 = sub i32 %right, %left
 34   %diff = select i1 %downto, i32 %4, i32 %5
 35   %len = add i32 %diff, 1
 36   %negative = icmp slt i32 %len, 0
 37   %len_clamp = select i1 %negative, i32 0, i32 %len
 38   call void @_assert_fail(i8* %aptr, i32 %len_clamp, i8 0, i32 2, i8* getelementptr inbounds ([24 x i8]* @module_name, i64 0,    i64 0))
 39   store i32 1, i32* @":reduced_image(test):_proc__state.0", align 8
 40   ret void
 41 }

Where something goes wrong is line 26, I guess.
ppc32-linux has completely unexpected TRACE output, maybe "call" is broken?

 ppc32-linux > TRACE 0ms+0: _image val=c8480b2010 where=1208754184 module="(null)"
 i686-cygwin > TRACE 0ms+0: _image val=4 where=200 module="WORK.REDUCED_IMAGE.elab"

-----------------------------------------------------------------------
Fix "nvc: tree.c:372: tree_ident: Assertion `t != ((void *)0)' failed."
-----------------------------------------------------------------------
Like above _image() issue, _inst_name() doesn't work on ppc32-linux.

See more detail:

 $ uname -a
 Linux wombat 3.3.1-gentoo #1 Thu Apr 5 17:30:06 JST 2012 ppc 7447A, altivec supported PowerMac10,2 GNU/Linux

 $ eix -Ic sys-devel/llvm
 [I] sys-devel/llvm (9999@04/06/12): Low Level Virtual Machine
 [NOTE: This sys-devel/llvm-9999 is compiled w/;
           CFLAGS="-O2 -mtune=G4 -mcpu=G4 -maltivec -mabi=altivec -Wall -fno-strict-aliasing -mno-altivec -mabi=no-altivec -ggdb"
         CXXFLAGS="-O2 -mtune=G4 -mcpu=G4 -maltivec -mabi=altivec -Wall -fno-strict-aliasing -mno-altivec -mabi=no-altivec -ggdb"
          LDFLAGS="-Wl,-O1 -Wl,--as-needed"
        to workaround LLVM's altivec bug.]

 $ llvm-config --version
 3.1svn
 [NOTE: This sys-devel/llvm-999 is live svn ebuild.
        ATM, used svn trunk tells me it is r154158.]

 $ git clone git://github.com/hiyuh/nvc.git
 [SNIP]
 $ cd nvc
 $ ./autogen.sh
 [SNIP]
 $ CFLAGS="-O0 -ggdb" CXXFLAGS="-O0 -ggdb" ./configure
 [SNIP]
 [NOTE: Prepare lib/ieee before make. :P]
 $ make
 [SNIP]
 $ make check
 [SNIP]
           elab3 : failed
 /home/hiyuh/git-repos/nvc/src/nvc -a /home/hiyuh/git-repos/nvc/test/regress/elab3.vhd
 /home/hiyuh/git-repos/nvc/src/nvc -e elab3
 /usr/bin/llvm-ld -r -b /home/hiyuh/git-repos/nvc/test/logs/elab3/work/_WORK.ELAB3.final.bc /home/hiyuh/git-repos/nvc/test/logs/elab3/work/_WORK.ELAB3.elab.bc
 /home/hiyuh/git-repos/nvc/src/nvc -r  elab3
 nvc: tree.c:372: tree_ident: Assertion `t != ((void *)0)' failed.
 Aborted
 [SNIP]

 $ cd test
 $ EXTRA_RFLAGS="--trace" ./run_regr.sh all elab3
 > analyze
 >> analyze regress/elab3.vhd
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -a regress/elab3.vhd
 > elaborate
 >> elaborate elab3
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -e elab3
 /usr/bin/llvm-ld -r -b /home/hiyuh/git-repos/nvc/test/work/_WORK.ELAB3.final.bc /home/hiyuh/git-repos/nvc/test/work/_WORK.ELAB3.elab.bc
 > run
 >> run elab3
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -r --trace elab3
 TRACE (init): signal :elab3(test):x at 0x480b2010
 TRACE (init): signal :elab3(test):s@sub(test):p at 0x480b2040
 TRACE (init): signal :elab3(test):b:y at 0x480b2070
 TRACE (init): process :elab3(test):s@sub(test):_proc at 0x48032010
 TRACE (init): process :elab3(test):b:_proc0 at 0x48032140
 TRACE (init): process :elab3(test):_proc1 at 0x48032270
 TRACE (init): reset process :elab3(test):s@sub(test):_proc
 TRACE (init): _sched_process delay=0ms
 TRACE (init): reset process :elab3(test):b:_proc0
 TRACE (init): _sched_process delay=0ms
 TRACE (init): reset process :elab3(test):_proc1
 TRACE (init): _sched_process delay=0ms
 TRACE 0ms+0: begin cycle
 0ms     process  :elab3(test):s@sub(test):_proc
 0ms     process  :elab3(test):b:_proc0
 0ms     process  :elab3(test):_proc1
 TRACE 0ms+0: run process :elab3(test):s@sub(test):_proc
 TRACE 0ms+0: _sched_process delay=2ns
 TRACE 0ms+0: run process :elab3(test):_proc1
 nvc: tree.c:372: tree_ident: Assertion `t != ((void *)0)' failed.
 Aborted

Try reduced regression again,

 $ EXTRA_RFLAGS="--trace" ./run_regr.sh all reduced_elab3
 > analyze
 >> analyze regress/reduced_elab3.vhd
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -a regress/reduced_elab3.vhd
 > elaborate
 >> elaborate reduced_elab3
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -e reduced_elab3
 /usr/bin/llvm-ld -r -b /home/hiyuh/git-repos/nvc/test/work/_WORK.REDUCED_ELAB3.final.bc /home/hiyuh/git-repos/nvc/test/work/_WORK.REDUCED_ELAB3.elab.bc
 > run
 >> run reduced_elab3
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -r --trace reduced_elab3
 TRACE (init): signal :reduced_elab3(test):x at 0x480b2010
 TRACE (init): process :reduced_elab3(test):_proc at 0x48032010
 TRACE (init): reset process :reduced_elab3(test):_proc
 TRACE (init): _sched_process delay=0ms
 TRACE 0ms+0: begin cycle
 0ms     process  :reduced_elab3(test):_proc
 TRACE 0ms+0: run process :reduced_elab3(test):_proc
 nvc: tree.c:372: tree_ident: Assertion `t != ((void *)0)' failed.
 Aborted

Also on i686-cygwin, it works fine.

 $ uname -a
 CYGWIN_NT-5.1 lion 1.7.11(0.260/5/3) 2012-02-24 14:05 i686 Cygwin

 $ EXTRA_RFLAGS="--trace" ./run_regr.sh all reduced_elab3
 > analyze
 >> analyze regress/reduced_elab3.vhd
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -a regress/reduced_elab3.vhd
 > elaborate
 >> elaborate reduced_elab3
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -e reduced_elab3
 /usr/bin/llvm-ld -r -b /home/hiyuh/git-repos/nvc/test/work/_WORK.REDUCED_ELAB3.final.bc /home/hiyuh/git-repos/nvc/test/work/_WORK.REDUCED_ELAB3.elab.bc
 > run
 >> run reduced_elab3
 NVC_LIBPATH=../lib/std:../lib/ieee ../src/nvc -r --trace reduced_elab3
 TRACE (init): signal :reduced_elab3(test):x at 0x7ff20010
 TRACE (init): process :reduced_elab3(test):_proc at 0x7ff30010
 TRACE (init): reset process :reduced_elab3(test):_proc
 TRACE (init): _sched_process delay=0ms
 TRACE 0ms+0: begin cycle
 0ms     process  :reduced_elab3(test):_proc
 TRACE 0ms+0: run process :reduced_elab3(test):_proc
 TRACE 0ms+0: _inst_name sig=:reduced_elab3(test):x
 TRACE 0ms+0: _assert_fail msg=:reduced_elab3(test):x msg_len=23 severity=0 where=198 module=WORK.REDUCED_ELAB3.elab
 ** Note: 0ms+0: Report Note: :reduced_elab3(test):x
         File regress/reduced_elab3.vhd, Line 10

To investigate more detail, do llvm-dis reduced regression's bitcode,

 $ llvm-dis work/_WORK.REDUCED_ELAB3.final.bc

Now we get following LLVM IR named work/_WORK.REDUCED_ELAB3.final.ll,

  1 ; ModuleID = 'work/_WORK.REDUCED_ELAB3.final.bc'
  2
  3 %signal_s = type { i64, i64, i8*, i8, i8, i16, i8*, i8*, i8* }
  4
  5 @module_name = private global [24 x i8] c"WORK.REDUCED_ELAB3.elab\00"
  6 @":reduced_elab3(test):x" = global %signal_s zeroinitializer
  7 @":reduced_elab3(test):_proc__state.0" = internal unnamed_addr global i32 undef, align 8
  8
  9 declare void @_sched_process(i64)
 10
 11 declare void @_assert_fail(i8*, i32, i8, i32, i8*)
 12
 13 declare { i8*, i32, i32, i8 } @_inst_name(i8*)
 14
 15 define void @":reduced_elab3(test):_proc"(i32) {
 16 entry:
 17   %1 = icmp eq i32 %0, 0
 18   %2 = load i32* @":reduced_elab3(test):_proc__state.0", align 8
 19   %switch = icmp ult i32 %2, 2
 20   %or.cond = and i1 %1, %switch
 21   br i1 %or.cond, label %start, label %init
 22
 23 init:                                             ; preds = %entry
 24   call void @_sched_process(i64 0)
 25   store i32 0, i32* @":reduced_elab3(test):_proc__state.0", align 8
 26   ret void
 27
 28 start:                                            ; preds = %entry
 29   %3 = call { i8*, i32, i32, i8 } @_inst_name(i8* bitcast (%signal_s* @":reduced_elab3(test):x" to i8*))
 30   %aptr = extractvalue { i8*, i32, i32, i8 } %3, 0
 31   %dir = extractvalue { i8*, i32, i32, i8 } %3, 3
 32   %downto = icmp eq i8 %dir, 1
 33   %left = extractvalue { i8*, i32, i32, i8 } %3, 1
 34   %right = extractvalue { i8*, i32, i32, i8 } %3, 2
 35   %4 = sub i32 %left, %right
 36   %5 = sub i32 %right, %left
 37   %diff = select i1 %downto, i32 %4, i32 %5
 38   %len = add i32 %diff, 1
 39   %negative = icmp slt i32 %len, 0
 40   %len_clamp = select i1 %negative, i32 0, i32 %len
 41   call void @_assert_fail(i8* %aptr, i32 %len_clamp, i8 0, i32 198, i8* getelementptr inbounds ([24 x i8]* @module_name, i64    0, i64 0))
 42   store i32 1, i32* @":reduced_elab3(test):_proc__state.0", align 8
 43   ret void
 44 }

Where something goes wrong is line 29, I guess.
